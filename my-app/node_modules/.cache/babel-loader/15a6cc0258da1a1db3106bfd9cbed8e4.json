{"ast":null,"code":"import { call, delay, put, race, take } from \"redux-saga/effects\";\nimport { fetchSendEmail, fetchCreateUser, fetchLoginUser, fetchResetPassword, fetchGetDataUser } from \"../../../services/services_user\";\nimport { HIDE_ERROR } from \"../../actions/types\";\nimport { push } from 'connected-react-router';\nimport { hideErrorAction, onCurrentUserAction, onLogoutAction, showErrorAction } from \"../../actions\";\n\nfunction* show_error() {\n  yield put(showErrorAction());\n  const {\n    hideTimeout\n  } = yield race({\n    hide: take(HIDE_ERROR),\n    hideTimeout: delay(3e3)\n  });\n\n  if (hideTimeout) {\n    yield put(hideErrorAction());\n  }\n}\n\nexport function* workGetUser(action) {\n  try {\n    const current_user = yield call(fetchGetDataUser);\n\n    if (current_user !== undefined && current_user.id !== undefined) {\n      yield put(onCurrentUserAction(current_user)); // переделать\n\n      yield put(push(`/todo/${current_user.id}`));\n    } else {\n      localStorage.removeItem('token');\n      yield put(onLogoutAction());\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}\nexport function* workerLoginUser(action) {\n  const user = action.user;\n  const login_user = {\n    username: user.username,\n    password: user.password\n  };\n\n  try {\n    const data = yield call(fetchLoginUser, login_user);\n    localStorage.setItem('token', data.token);\n    const current_user = data.user;\n    yield put(onCurrentUserAction(current_user)); // переделать\n\n    push('/todo/' + current_user.id);\n  } catch (error) {\n    console.log('ERROR_SAGA: ', error);\n    yield call(show_error);\n  }\n}\nexport function* workerCreateUser(action) {\n  try {\n    const data = yield call(fetchCreateUser, action.user);\n\n    if (data) {\n      yield call(show_error);\n    } else {\n      console.log('pushP ', yield put(push('/')));\n      yield put(push('/'));\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA_SIGN_UP ', error);\n  }\n}\nexport function* workerResetPassword(action) {\n  const password = action.password;\n  const token = action.token;\n\n  try {\n    const data = yield call(fetchResetPassword, password, token);\n\n    if (data) {\n      yield call(show_error);\n    } else {\n      yield put(push('/'));\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}\nexport function* workerSendEmail(action) {\n  const email = action.email;\n\n  try {\n    yield call(fetchSendEmail, email);\n    yield put(push('/'));\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}","map":{"version":3,"sources":["/home/julia/ToDoList/my-app/src/store/saga/sagaUser/index.tsx"],"names":["call","delay","put","race","take","fetchSendEmail","fetchCreateUser","fetchLoginUser","fetchResetPassword","fetchGetDataUser","HIDE_ERROR","push","hideErrorAction","onCurrentUserAction","onLogoutAction","showErrorAction","show_error","hideTimeout","hide","workGetUser","action","current_user","undefined","id","localStorage","removeItem","error","console","log","workerLoginUser","user","login_user","username","password","data","setItem","token","workerCreateUser","workerResetPassword","workerSendEmail","email"],"mappings":"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","sourcesContent":["import { call, delay, put, race, take } from \"redux-saga/effects\" ;\nimport { fetchSendEmail, fetchCreateUser, fetchLoginUser, fetchResetPassword, fetchGetDataUser } from \"../../../services/services_user\";\nimport { HIDE_ERROR } from \"../../actions/types\";\nimport { IUser } from \"../../../interfaces/IUser\";\nimport { push } from 'connected-react-router';\nimport { hideErrorAction, onCurrentUserAction, onLogoutAction, showErrorAction } from \"../../actions\";\n\n\nfunction* show_error(){\n\n    yield put(showErrorAction());\n    const { hideTimeout } = yield race({\n        hide: take(HIDE_ERROR),\n        hideTimeout: delay(3e3),\n    });\n\n    if (hideTimeout) {\n        yield put(hideErrorAction())\n    }\n}\n\nexport function* workGetUser(action){\n    try{\n        const current_user = yield call(fetchGetDataUser);\n        if(current_user !== undefined && current_user.id !== undefined){\n            yield put(onCurrentUserAction(current_user))\n            // переделать\n            yield put (push(`/todo/${current_user.id}`));\n        }else{\n            localStorage.removeItem('token');\n            yield put(onLogoutAction())\n        }\n    } catch(error){\n        console.log('ERROR_SAGA ', error);\n    }\n}\n\nexport function* workerLoginUser(action) {\n    \n    const user : IUser = action.user;\n    const login_user = {\n        username : user.username,\n        password : user.password!\n    };\n    try{\n        const data  = yield call(fetchLoginUser,login_user);\n        localStorage.setItem('token', data.token);\n        \n        const current_user = data.user;\n        yield put(onCurrentUserAction(current_user));\n        // переделать\n        push('/todo/' + current_user.id);\n\n    }catch(error){\n        console.log('ERROR_SAGA: ', error);\n        yield call(show_error)\n    }\n}\n\nexport function* workerCreateUser(action){\n    \n    try{\n        const data = yield call(fetchCreateUser,action.user);\n        if (data){\n            yield call(show_error);\n        }else{\n            console.log('pushP ',  yield put(push('/')));\n            yield put(push('/'));\n        }\n    }catch(error){\n        console.log('ERROR_SAGA_SIGN_UP ', error );\n    }\n}\n\nexport function* workerResetPassword(action){\n    const password : string = action.password;\n    const token = action.token;\n\n    try {\n        const data = yield call(fetchResetPassword, password, token);\n        if(data){\n            yield call(show_error);\n        }else{\n            yield put(push('/'));\n        }\n    }catch(error){\n        console.log('ERROR_SAGA ', error );\n    }\n}\n\nexport function* workerSendEmail(action){\n    const email : string = action.email;\n    \n    try {\n        yield call(fetchSendEmail, email);\n        yield put(push('/'));\n    }catch(error){\n        console.log('ERROR_SAGA ', error )\n    }\n    \n}"]},"metadata":{},"sourceType":"module"}