{"ast":null,"code":"var _jsxFileName = \"/home/julia/ToDoList/my-app/src/ pages/User.tsx\";\nimport React, { useEffect } from 'react';\nimport { connect, useSelector } from 'react-redux';\nimport Route from '../Router';\nimport { reset } from 'redux-form';\nimport { call, takeEvery, put } from \"redux-saga/effects\";\nconst initialStateUser = {\n  id: 0,\n  username: '',\n  logged_in: false\n};\nexport function user_reducer(state = initialStateUser, action) {\n  switch (action.type) {\n    case 'GET_TOKEN':\n      return { ...state,\n        logged_in: state.logged_in = true\n      };\n\n    case 'CURRENT_USER':\n      return { ...state,\n        username: action.current_user.username,\n        id: action.current_user.id,\n        logged_in: true\n      };\n\n    case 'INITIAL_USER':\n      localStorage.removeItem('token');\n      return { ...state,\n        username: '',\n        id: 0,\n        logged_in: false\n      };\n\n    default:\n      return state;\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onAddTask: newTask => {\n      dispatch(addTaskAction(newTask));\n      dispatch(reset('createTask'));\n    },\n    onToggle: task => {\n      dispatch(toggleTaskAction(task));\n    },\n    onRemove: task => {\n      dispatch(removeTaskAction(task));\n    },\n    onLoginUser: (user, history) => {\n      dispatch(onLoginUserAction(user, history));\n    },\n    onCreateUser: (user, history) => {\n      dispatch(onCreateUserAction(user, history));\n    },\n    onResetPassword: (email, history) => {\n      dispatch(onResetPasswordAction(email, history));\n    },\n    onGetToken: () => {\n      dispatch(onGetTokenAction());\n    },\n    onLogout: () => {\n      dispatch(onLogoutAction());\n    },\n    onCurrentUser: current_user => {\n      dispatch(onCurrentUserAction(current_user));\n    },\n    onGetUser: () => {\n      dispatch(onGetUserAction());\n    }\n  };\n};\n\nconst toggleTaskAction = task => {\n  return {\n    type: 'TOGGLE_TASK',\n    task\n  };\n};\n\nconst removeTaskAction = task => {\n  return {\n    type: 'REMOVE_TASK',\n    task\n  };\n};\n\nconst addTaskAction = newTask => {\n  return {\n    type: 'CREATE_TASK',\n    newTask\n  };\n};\n\nconst onLoginUserAction = (user, history) => {\n  return {\n    type: 'LOGIN_USER',\n    user,\n    history\n  };\n};\n\nconst onCreateUserAction = (user, history) => {\n  return {\n    type: 'CREATE_USER',\n    user,\n    history\n  };\n};\n\nconst onResetPasswordAction = (email, history) => {\n  return {\n    type: 'RESET_PASSWORD',\n    email,\n    history\n  };\n};\n\nconst onGetTokenAction = () => {\n  return {\n    type: 'GET_TOKEN'\n  };\n};\n\nconst onLogoutAction = () => {\n  return {\n    type: 'INITIAL_USER'\n  };\n};\n\nconst onCurrentUserAction = current_user => {\n  return {\n    type: 'CURRENT_USER',\n    current_user\n  };\n};\n\nconst onGetUserAction = () => {\n  return {\n    type: 'GET_USER'\n  };\n};\n\nfunction getCookie(name) {\n  let cookieValue = null;\n\n  if (document.cookie && document.cookie !== '') {\n    const cookies = document.cookie.split(';');\n\n    for (let i = 0; i < cookies.length; i++) {\n      const cookie = cookies[i].trim(); // Does this cookie string begin with the name we want?\n\n      if (cookie.substring(0, name.length + 1) === name + '=') {\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n        break;\n      }\n    }\n  }\n\n  return cookieValue;\n}\n\nexport function* watchCreateTask() {\n  yield takeEvery('CREATE_TASK', workCreateTask);\n}\n\nfunction* workCreateTask(action) {\n  // yield console.log(action.newTask)\n  const csrftoken = getCookie('csrftoken');\n  const url = 'http://127.0.0.1:8000/api/task_create/';\n\n  try {\n    const data = yield call(() => {\n      fetch(url, {\n        mode: 'cors',\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/json',\n          'X-CSRFToken': csrftoken,\n          Authorization: 'JWT ' + localStorage.getItem('token')\n        },\n        body: JSON.stringify(action.newTask)\n      }).catch(function (error) {\n        console.log('ERROR:', error);\n      });\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nexport function* watchToggleTask() {\n  yield takeEvery('TOGGLE_TASK', workToggleTask);\n}\n\nfunction* workToggleTask(action) {\n  const task = action.task; //console.log('toggle: ', task)\n\n  task.completed = !task.completed;\n  const csrftoken = getCookie('csrftoken');\n  const url = 'http://127.0.0.1:8000/api/task_update/' + task.id + '/';\n\n  try {\n    const data = yield call(() => {\n      fetch(url, {\n        mode: 'cors',\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/json',\n          'X-CSRFToken': csrftoken,\n          Authorization: 'JWT ' + localStorage.getItem('token')\n        },\n        body: JSON.stringify(task)\n      }).catch(function (error) {\n        console.log('ERROR:', error);\n      });\n    }); //yield console.log(`response = ${JSON.stringify(data)}`); \n  } catch (error) {\n    console.log(error);\n  }\n}\n\nexport function* watchRemoveTask() {\n  yield takeEvery('REMOVE_TASK', workRemoveTask);\n}\n\nfunction* workRemoveTask(action) {\n  const task = action.task; //console.log('remove: ', task)\n\n  const csrftoken = getCookie('csrftoken');\n  const url = 'http://127.0.0.1:8000/api/task_delete/' + task.id + '/';\n\n  try {\n    yield call(() => {\n      fetch(url, {\n        mode: 'cors',\n        method: 'DELETE',\n        headers: {\n          'Content-type': 'application/json',\n          'X-CSRFToken': csrftoken,\n          Authorization: 'JWT ' + localStorage.getItem('token')\n        }\n      }).then(response => {\n        console.log('deleted : ', response);\n      }).catch(function (error) {\n        console.log('ERROR:', error);\n      });\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nexport function* watch_login_user() {\n  yield takeEvery('LOGIN_USER', worker_login_user);\n}\n\nfunction* worker_login_user(action) {\n  const user = action.user;\n  const {\n    history\n  } = action;\n  const login_user = {\n    username: user.username,\n    password: user.password\n  };\n\n  try {\n    const data = yield call(() => fetch_token_auth(login_user)); // console.log('CURRENT_USER : ', data.user)\n\n    localStorage.setItem('token', data.token);\n    const current_user = data.user;\n    yield put({\n      type: 'CURRENT_USER',\n      current_user\n    });\n    const url = '/todo/' + current_user.id;\n    history.push(url);\n  } catch (error) {\n    console.log('ERROR: ', error);\n  }\n}\n\nasync function fetch_token_auth(login_user) {\n  const csrftoken = getCookie('csrftoken');\n  const response = fetch('http://127.0.0.1:8000/token-auth/', {\n    mode: 'cors',\n    method: 'POST',\n    headers: {\n      'Content-type': 'application/json',\n      'X-CSRFToken': csrftoken\n    },\n    body: JSON.stringify(login_user)\n  });\n  const data = response.then(response => response.json()).catch(error => console.log('ERROR: ', error));\n  return await data;\n}\n\nexport function* watch_create_user() {\n  yield takeEvery('CREATE_USER', worker_create_user);\n}\n\nfunction* worker_create_user(action) {\n  const user = action.user;\n  const {\n    history\n  } = action;\n  const create_user = {\n    username: user.username,\n    password: user.password,\n    email: user.email\n  };\n  console.log('CREATE_USER: ', create_user);\n  const csrftoken = getCookie('csrftoken');\n  const body = {\n    'user': {\n      'username': create_user.username,\n      'email': create_user.email,\n      'password': create_user.password\n    }\n  };\n  yield call(() => {\n    fetch('http://127.0.0.1:8000/api_users/users/create', {\n      mode: 'cors',\n      method: 'POST',\n      headers: {\n        'Content-type': 'application/json',\n        'X-CSRFToken': csrftoken\n      },\n      body: JSON.stringify(body)\n    }).then(response => {\n      response.json();\n      history.push('/');\n      console.log('CREATE_RESULT : ', response);\n    }).catch(error => console.log('ERROR: ', error));\n  });\n}\n\nexport function* watch_reset_password() {\n  yield takeEvery('RESET_PASSWORD', worker_reset_password);\n}\n\nfunction* worker_reset_password(action) {\n  const email = action.email;\n  const {\n    history\n  } = action;\n  console.log('RESET_PASSWORD: ', email);\n  const body = {\n    email: email\n  };\n  console.log(); // const csrftoken = getCookie('csrftoken')\n  // yield call(() => {\n  //     fetch('http://127.0.0.1:8000/api/password_reset/', {\n  //         mode : 'cors',\n  //         method : 'POST',\n  //         headers: {\n  //             'Content-type' : 'application/json',\n  //             'X-CSRFToken' : csrftoken!,\n  //         },\n  //         body : JSON.stringify({email})\n  //     },)\n  //     .then(response => {\n  //         response.json()\n  //         history.push('/')\n  //         console.log('SEND_EMAIL : ', response)\n  //     })\n  //     .catch(error => console.log('ERROR: ', error))\n  // })\n}\n\nconst User = props => {\n  if (localStorage.getItem('token')) {\n    props.onGetToken();\n  }\n\n  const current_state_user = useSelector(state => state.user_data.logged_in);\n  useEffect(() => {\n    if (current_state_user) {\n      try {\n        fetch('http://127.0.0.1:8000/api_users/current_user/', {\n          mode: 'cors',\n          method: 'GET',\n          headers: {\n            Authorization: 'JWT ' + localStorage.getItem('token')\n          }\n        }).then(response => response.json()).then(data => {\n          const current_user = {\n            id: data.id,\n            username: data.username,\n            logged_in: true\n          };\n\n          if (current_user.id !== undefined) {\n            props.onCurrentUser(current_user);\n            const url = 'todo/' + current_user.id;\n          } else {\n            props.onLogout();\n          }\n        });\n      } catch (error) {\n        console.log('ERROR: ', error);\n      }\n    }\n  }, [current_state_user]);\n  return /*#__PURE__*/React.createElement(Route, Object.assign({}, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default connect(null, mapDispatchToProps)(User);","map":{"version":3,"sources":["/home/julia/ToDoList/my-app/src/ pages/User.tsx"],"names":["React","useEffect","connect","useSelector","Route","reset","call","takeEvery","put","initialStateUser","id","username","logged_in","user_reducer","state","action","type","current_user","localStorage","removeItem","mapDispatchToProps","dispatch","onAddTask","newTask","addTaskAction","onToggle","task","toggleTaskAction","onRemove","removeTaskAction","onLoginUser","user","history","onLoginUserAction","onCreateUser","onCreateUserAction","onResetPassword","email","onResetPasswordAction","onGetToken","onGetTokenAction","onLogout","onLogoutAction","onCurrentUser","onCurrentUserAction","onGetUser","onGetUserAction","getCookie","name","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","watchCreateTask","workCreateTask","csrftoken","url","data","fetch","mode","method","headers","Authorization","getItem","body","JSON","stringify","catch","error","console","log","watchToggleTask","workToggleTask","completed","watchRemoveTask","workRemoveTask","then","response","watch_login_user","worker_login_user","login_user","password","fetch_token_auth","setItem","token","push","json","watch_create_user","worker_create_user","create_user","watch_reset_password","worker_reset_password","User","props","current_state_user","user_data","undefined"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect, useSelector } from 'react-redux';\nimport Route from '../Router'\nimport { ITodo, IUser } from '../interface';\nimport { reset } from 'redux-form';\nimport { call, takeEvery, put } from \"redux-saga/effects\" ;\nimport { RootState } from '../redux/reduxStore';\n\n\nconst initialStateUser : IUser = {\n    id: 0,\n    username: '',\n    logged_in : false\n}\n\nexport function user_reducer ( state = initialStateUser, action) : IUser {\n    switch(action.type){\n        case 'GET_TOKEN':\n            return { ...state, logged_in : state.logged_in = true };\n        case 'CURRENT_USER':\n            return { ...state, username : action.current_user.username, id : action.current_user.id, logged_in : true };\n        case 'INITIAL_USER':\n            localStorage.removeItem('token')\n            return { ...state, username : '', id : 0, logged_in : false };\n        default : return state\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n\n    return({\n        onAddTask : (newTask : ITodo) => {\n            dispatch(addTaskAction(newTask))\n            dispatch(reset('createTask'))\n        },\n        onToggle : (task : ITodo) => {\n            dispatch(toggleTaskAction(task))\n        },\n        onRemove : (task : ITodo) => {\n            dispatch(removeTaskAction(task))\n        }, \n        onLoginUser : (user : IUser, history) => {\n            dispatch(onLoginUserAction(user, history))\n        },\n        onCreateUser : (user : IUser, history) => {\n            dispatch(onCreateUserAction(user, history))\n        },\n        onResetPassword : (email: string, history) => {\n            dispatch(onResetPasswordAction(email, history))\n        },\n        onGetToken : () => { dispatch(onGetTokenAction()) },\n        onLogout : () => { dispatch(onLogoutAction()) },\n        onCurrentUser : (current_user: IUser) => { dispatch(onCurrentUserAction(current_user) )},\n        onGetUser : () => {dispatch(onGetUserAction())}\n    })\n}\n\nconst toggleTaskAction = (task : ITodo) => {\n    return {\n        type: 'TOGGLE_TASK',\n        task\n    }\n}\n\nconst removeTaskAction = (task : ITodo) => {\n    return {\n        type : 'REMOVE_TASK',\n        task\n    }\n}\n\nconst addTaskAction = (newTask : ITodo) =>{\n    return {\n        type: 'CREATE_TASK',\n        newTask\n    }\n}\n\nconst onLoginUserAction = (user : IUser, history) => {\n    return {\n        type : 'LOGIN_USER',\n        user, \n        history\n    }\n}\n\nconst onCreateUserAction = (user : IUser, history) => {\n    return {\n        type : 'CREATE_USER',\n        user,\n        history\n    }\n}\n\nconst onResetPasswordAction = (email: string, history) =>{\n    return{\n        type: 'RESET_PASSWORD',\n        email,\n        history\n    }\n}\nconst onGetTokenAction = () => {\n    return{\n        type : 'GET_TOKEN'\n    }\n}\n\nconst onLogoutAction = () => {\n    return {\n        type: 'INITIAL_USER'\n    }\n}\n\nconst onCurrentUserAction = (current_user : IUser) => {\n    return {\n        type: 'CURRENT_USER',\n        current_user\n    }\n}\n\nconst onGetUserAction = () => {\n    return{\n        type: 'GET_USER'\n    }\n}\n\nfunction getCookie(name : string) {\n    let cookieValue : string | null = null;\n    if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n            const cookie = cookies[i].trim();\n            // Does this cookie string begin with the name we want?\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\nexport function* watchCreateTask(){\n    yield takeEvery('CREATE_TASK', workCreateTask)\n}\n\n\nfunction* workCreateTask(action) {\n\n   // yield console.log(action.newTask)\n\n    const csrftoken = getCookie('csrftoken');\n    const url = 'http://127.0.0.1:8000/api/task_create/'\n        \n    try{\n        const data = yield call(() => {\n            fetch(url, {\n                mode : 'cors',\n                method: 'POST',\n                headers : {\n                    'Content-type' : 'application/json',\n                    'X-CSRFToken' : csrftoken!,\n                    Authorization : 'JWT ' + localStorage.getItem('token')\n                },\n                body : JSON.stringify(action.newTask)\n            }).catch(function(error){\n                console.log('ERROR:' , error)\n            })\n        })\n    } catch(error){\n        console.log(error)\n    }\n}\n\nexport function* watchToggleTask(){\n    yield takeEvery('TOGGLE_TASK', workToggleTask)\n}\n\nfunction* workToggleTask(action){\n    \n    const task : ITodo = action.task\n    //console.log('toggle: ', task)\n    task.completed = !task.completed\n\n    const csrftoken = getCookie('csrftoken');\n    const url = 'http://127.0.0.1:8000/api/task_update/' + task.id + '/'\n        \n    try{\n        const data = yield call(() => {\n            fetch(url, {\n                mode : 'cors',\n                method: 'POST',\n                headers : {\n                    'Content-type' : 'application/json',\n                    'X-CSRFToken' : csrftoken!,\n                    Authorization : 'JWT ' + localStorage.getItem('token')\n                },\n                body : JSON.stringify(task)\n            }).catch(function(error){\n                console.log('ERROR:' , error)\n            })\n        })\n        //yield console.log(`response = ${JSON.stringify(data)}`); \n    } catch(error){\n        console.log(error)\n    }\n}\n\nexport function* watchRemoveTask(){\n    yield takeEvery('REMOVE_TASK', workRemoveTask)\n}\n\nfunction* workRemoveTask(action){\n    \n    const task : ITodo = action.task\n    //console.log('remove: ', task)\n\n    const csrftoken = getCookie('csrftoken');\n    const url = 'http://127.0.0.1:8000/api/task_delete/' + task.id + '/'\n        \n    try{\n        yield call(() => {\n            fetch(url, {\n                mode : 'cors',\n                method: 'DELETE',\n                headers : {\n                    'Content-type' : 'application/json',\n                    'X-CSRFToken' : csrftoken!,\n                    Authorization : 'JWT ' + localStorage.getItem('token')\n                },\n            }).then((response) => {\n                console.log('deleted : ', response)\n            })\n            .catch(function(error){\n                console.log('ERROR:' , error)\n            })\n        })\n    } catch(error){\n        console.log(error)\n    }\n}\n\nexport function* watch_login_user(){\n    yield takeEvery('LOGIN_USER', worker_login_user)\n}\n\nfunction* worker_login_user(action) {\n    \n    const user : IUser = action.user\n    const { history } = action\n    const login_user = {\n        username : user.username,\n        password : user.password!\n    }    \n    try{\n        const data  = yield call(() => fetch_token_auth(login_user))\n       // console.log('CURRENT_USER : ', data.user)\n        localStorage.setItem('token', data.token)\n        const current_user = data.user\n        yield put({type : 'CURRENT_USER', current_user})\n        const url : string = '/todo/' + current_user.id\n        history.push(url)\n    }catch(error){\n        console.log('ERROR: ', error)\n    }\n}\n\nasync function fetch_token_auth(login_user) {\n\n    const csrftoken = getCookie('csrftoken')\n    const response = fetch('http://127.0.0.1:8000/token-auth/', {\n        mode : 'cors',\n        method : 'POST',\n        headers: {\n            'Content-type' : 'application/json',\n            'X-CSRFToken' : csrftoken!,\n        },\n        body : JSON.stringify(login_user)\n    })\n    const data = response.then(response => response.json())\n    .catch(error => console.log('ERROR: ', error))\n    return await data\n}\n\nexport function* watch_create_user(){\n    yield takeEvery('CREATE_USER', worker_create_user)\n}\n\nfunction* worker_create_user(action){\n    \n    const user : IUser = action.user\n    const { history }  = action\n\n    const create_user = {\n        username : user.username,\n        password : user.password!,\n        email : user.email!\n    }\n\n    console.log('CREATE_USER: ', create_user)\n\n    const csrftoken = getCookie('csrftoken')\n\n    const body = {'user' : {\n        'username' : create_user.username,\n        'email' : create_user.email,\n        'password' : create_user.password\n        }\n    }\n    \n    yield call(() => {\n        fetch('http://127.0.0.1:8000/api_users/users/create', {\n            mode : 'cors',\n            method : 'POST',\n            headers: {\n                'Content-type' : 'application/json',\n                'X-CSRFToken' : csrftoken!,\n            },\n            body : JSON.stringify(body)\n        },)\n        .then(response => {\n            response.json()\n            history.push('/')\n            console.log('CREATE_RESULT : ', response)\n        })\n        .catch(error => console.log('ERROR: ', error))\n    })\n}\n\nexport function* watch_reset_password(){\n    yield takeEvery('RESET_PASSWORD', worker_reset_password)\n}\n\nfunction* worker_reset_password(action){\n    const email : string = action.email\n    const { history }  = action\n\n    console.log('RESET_PASSWORD: ', email)\n\n    const body = {\n        email : email\n    }\n    console.log()\n\n    // const csrftoken = getCookie('csrftoken')\n    \n    // yield call(() => {\n    //     fetch('http://127.0.0.1:8000/api/password_reset/', {\n    //         mode : 'cors',\n    //         method : 'POST',\n    //         headers: {\n    //             'Content-type' : 'application/json',\n    //             'X-CSRFToken' : csrftoken!,\n    //         },\n    //         body : JSON.stringify({email})\n    //     },)\n    //     .then(response => {\n    //         response.json()\n    //         history.push('/')\n    //         console.log('SEND_EMAIL : ', response)\n    //     })\n    //     .catch(error => console.log('ERROR: ', error))\n    // })\n}\n\nconst User = (props : any) => {\n\n    if (localStorage.getItem('token')){\n        props.onGetToken()\n    }\n\n    const current_state_user = useSelector((state : RootState) => state.user_data.logged_in)\n\n    useEffect(() => {\n        if(current_state_user){\n            try{\n                fetch('http://127.0.0.1:8000/api_users/current_user/',\n                    {\n                        mode: 'cors',\n                        method : 'GET',\n                        headers: {\n                            Authorization : 'JWT ' + localStorage.getItem('token')\n                        }\n                    }\n                )\n                .then(response => response.json())\n                .then(data => {\n                    const current_user : IUser = {id : data.id, username : data.username, logged_in : true}\n                    if(current_user.id !== undefined){\n                        props.onCurrentUser(current_user)\n                        const url : string= 'todo/'+ current_user.id\n                    }else{\n                        props.onLogout()\n                    }\n                })\n            }catch(error){\n                console.log('ERROR: ', error)\n            }\n        }\n    }, [current_state_user])\n\n    \n    \n    return (\n        <Route  {...props} />\n    );\n}\n\nexport default connect(null, mapDispatchToProps)(User);"]},"metadata":{},"sourceType":"module"}