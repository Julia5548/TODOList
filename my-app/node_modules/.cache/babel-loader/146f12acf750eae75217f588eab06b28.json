{"ast":null,"code":"var _jsxFileName = \"/home/julia/ToDoList/my-app/src/pages/User.tsx\";\nimport React, { useEffect } from 'react';\nimport { connect, useSelector } from 'react-redux';\nimport Route from '../routes';\nimport { reset } from 'redux-form';\nimport { addTaskAction, toggleTaskAction, removeTaskAction, onLogoutAction, onCurrentUserAction } from '../store/actions';\nimport { onGetTokenAction, onGetUserAction } from '../store/actions';\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onAddTask: newTask => {\n      dispatch(addTaskAction(newTask));\n      dispatch(reset('createTask'));\n    },\n    onToggle: task => {\n      dispatch(toggleTaskAction(task));\n    },\n    onRemove: task => {\n      dispatch(removeTaskAction(task));\n    },\n    onGetToken: () => {\n      dispatch(onGetTokenAction());\n    },\n    onLogout: () => {\n      dispatch(onLogoutAction());\n    },\n    onCurrentUser: current_user => {\n      dispatch(onCurrentUserAction(current_user));\n    },\n    onGetUser: () => {\n      dispatch(onGetUserAction());\n    }\n  };\n};\n\nconst mapStateToProps = state => ({\n  username: state.user_data.username,\n  is_error_auth: state.user_data.is_error_auth\n});\n\nconst User = props => {\n  if (localStorage.getItem('token')) {\n    props.onGetToken();\n  }\n\n  const current_state_user = useSelector(state => state.user_data.is_logged_in);\n  useEffect(() => {\n    if (current_state_user) {\n      try {\n        fetch('http://127.0.0.1:8000/api_users/current_user/', {\n          mode: 'cors',\n          method: 'GET',\n          headers: {\n            Authorization: 'JWT ' + localStorage.getItem('token')\n          }\n        }).then(response => response.json()).then(data => {\n          const current_user = {\n            id: data.id,\n            username: data.username,\n            isLoggedIn: true,\n            isErrorAuth: false\n          };\n\n          if (current_user.id !== undefined) {\n            props.onCurrentUser(current_user);\n            const url = 'todo/' + current_user.id;\n          } else {\n            props.onLogout();\n          }\n        });\n      } catch (error) {\n        console.log('ERROR: ', error);\n      }\n    }\n  }, [current_state_user]);\n  return /*#__PURE__*/React.createElement(Route, Object.assign({}, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(User);","map":{"version":3,"sources":["/home/julia/ToDoList/my-app/src/pages/User.tsx"],"names":["React","useEffect","connect","useSelector","Route","reset","addTaskAction","toggleTaskAction","removeTaskAction","onLogoutAction","onCurrentUserAction","onGetTokenAction","onGetUserAction","mapDispatchToProps","dispatch","onAddTask","newTask","onToggle","task","onRemove","onGetToken","onLogout","onCurrentUser","current_user","onGetUser","mapStateToProps","state","username","user_data","is_error_auth","User","props","localStorage","getItem","current_state_user","is_logged_in","fetch","mode","method","headers","Authorization","then","response","json","data","id","isLoggedIn","isErrorAuth","undefined","url","error","console","log"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport { connect, useSelector } from 'react-redux';\nimport Route from '../routes'\nimport { reset } from 'redux-form';\nimport { RootState } from '../store/reducers';\nimport { addTaskAction, toggleTaskAction, removeTaskAction, onLogoutAction, onCurrentUserAction } from '../store/actions';\nimport { onLoginUserAction, onCreateUserAction, onResetPasswordAction, onGetTokenAction , onGetUserAction} from '../store/actions';\nimport { ITodo } from '../interfaces/ITodo';\nimport { IUser } from '../interfaces/IUser';\n\n\nconst mapDispatchToProps = (dispatch) => {\n    return({\n        onAddTask : (newTask : ITodo) => {\n            dispatch(addTaskAction(newTask))\n            dispatch(reset('createTask'))\n        },\n        onToggle : (task : ITodo) => {\n            dispatch(toggleTaskAction(task))\n        },\n        onRemove : (task : ITodo) => {\n            dispatch(removeTaskAction(task))\n        },\n        onGetToken : () => { \n            dispatch(onGetTokenAction()) \n        },\n        onLogout : () => { \n            dispatch(onLogoutAction()) \n        },\n        onCurrentUser : (current_user: IUser) => { \n            dispatch(onCurrentUserAction(current_user))\n        },\n        onGetUser : () => {\n            dispatch(onGetUserAction())\n        }\n    })\n}\n\nconst mapStateToProps = (state) => ({\n    username : state.user_data.username,\n    is_error_auth : state.user_data.is_error_auth\n})\n\nconst User = (props : any) => {\n\n    if (localStorage.getItem('token')){\n        props.onGetToken();\n    }\n\n    const current_state_user = useSelector((state : RootState) => state.user_data.is_logged_in);\n\n    useEffect(() => {\n        if(current_state_user){\n            try{\n                fetch('http://127.0.0.1:8000/api_users/current_user/',\n                    {\n                        mode: 'cors',\n                        method : 'GET',\n                        headers: {\n                            Authorization : 'JWT ' + localStorage.getItem('token')\n                        }\n                    }\n                )\n                .then(response => \n                    response.json()\n                )\n                .then(data => {\n                    const current_user : IUser = {\n                        id : data.id, \n                        username : data.username, \n                        isLoggedIn : true,\n                        isErrorAuth : false\n                    };\n                    if(current_user.id !== undefined){\n                        props.onCurrentUser(current_user);\n                        const url : string= 'todo/'+ current_user.id;\n                    }else{\n                        props.onLogout();\n                    }\n                })\n            }catch(error){\n                console.log('ERROR: ', error)\n            }\n        }\n    }, [current_state_user])\n\n    return (\n        <Route {...props}/>\n    );\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(User);"]},"metadata":{},"sourceType":"module"}