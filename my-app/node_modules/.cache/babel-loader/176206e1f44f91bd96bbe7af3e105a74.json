{"ast":null,"code":"import { call, delay, put, race, take } from \"redux-saga/effects\";\nimport { fetchSendEmail, fetchCreateUser, fetchResetPassword, fetchGetDataUser } from \"../../../services/services_user\";\nimport { HIDE_ERROR } from \"../../actions/types\";\nimport { push } from 'connected-react-router';\nimport { hideErrorAction, onCurrentUserAction, onLogoutAction, showErrorAction } from \"../../actions\";\n\nfunction* show_error(data) {\n  yield put(showErrorAction(data));\n  const {\n    hideTimeout\n  } = yield race({\n    hide: take(HIDE_ERROR),\n    hideTimeout: delay(3e3)\n  });\n\n  if (hideTimeout) {\n    yield put(hideErrorAction());\n  }\n}\n\nexport function* workGetUser() {\n  try {\n    const current_user = yield call(fetchGetDataUser);\n\n    if (current_user && current_user.id !== undefined) {\n      yield put(onCurrentUserAction(current_user));\n      yield put(push('/todo'));\n    } else {\n      localStorage.removeItem('token');\n      yield put(onLogoutAction());\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}\nexport function* workerLoginUser(action) {\n  const user = action.user;\n  console.log(user); // try{\n  //     const data  = yield call(fetchLoginUser,user);\n  //     localStorage.setItem('token', data.token);\n  //     const current_user = data.user;\n  //     yield put(onCurrentUserAction(current_user));\n  //     yield put(push('/todo'));\n  // }catch(error){\n  //     console.log('ERROR_SAGA: ', error);\n  //     const textError = 'Неверен логин или пароль';\n  //     yield call(show_error, { textError });\n  // }\n}\nexport function* workerCreateUser(action) {\n  try {\n    const responseData = yield call(fetchCreateUser, action.user);\n\n    if (responseData.token) {\n      yield put(push('/'));\n    } else {\n      let error;\n\n      if (responseData.username && responseData.password) {\n        error = \"Такой пользователь существует. Пароль слишком легкий.\";\n      } else if (responseData.password) {\n        error = \"Пароль слишком легкий.\";\n      } else if (responseData.username) {\n        error = \"Такой пользователь существует.\";\n      }\n\n      if (error) {\n        yield call(show_error, {\n          error\n        });\n      }\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA_SIGN_UP ', error);\n  }\n}\nexport function* workerResetPassword(action) {\n  const password = action.password;\n  const token = action.token;\n\n  try {\n    const data = yield call(fetchResetPassword, password, token);\n\n    if (data) {\n      yield call(show_error);\n    } else {\n      yield put(push('/'));\n    }\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}\nexport function* workerSendEmail(action) {\n  const email = action.email;\n\n  try {\n    yield call(fetchSendEmail, email);\n    yield put(push('/'));\n  } catch (error) {\n    console.log('ERROR_SAGA ', error);\n  }\n}","map":{"version":3,"sources":["/home/julia/ToDoList/my-app/src/store/saga/sagaUser/index.tsx"],"names":["call","delay","put","race","take","fetchSendEmail","fetchCreateUser","fetchResetPassword","fetchGetDataUser","HIDE_ERROR","push","hideErrorAction","onCurrentUserAction","onLogoutAction","showErrorAction","show_error","data","hideTimeout","hide","workGetUser","current_user","id","undefined","localStorage","removeItem","error","console","log","workerLoginUser","action","user","workerCreateUser","responseData","token","username","password","workerResetPassword","workerSendEmail","email"],"mappings":"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","sourcesContent":["import { call, delay, put, race, take } from \"redux-saga/effects\" ;\nimport { fetchSendEmail, fetchCreateUser, fetchLoginUser, fetchResetPassword, fetchGetDataUser } from \"../../../services/services_user\";\nimport { HIDE_ERROR } from \"../../actions/types\";\nimport { IUser } from \"../../../interfaces/IUser\";\nimport { push } from 'connected-react-router';\nimport { hideErrorAction, onCurrentUserAction, onLogoutAction, showErrorAction } from \"../../actions\";\n\n\nfunction* show_error(data?){\n\n    yield put(showErrorAction(data));\n    const { hideTimeout } = yield race({\n        hide: take(HIDE_ERROR),\n        hideTimeout: delay(3e3),\n    });\n\n    if (hideTimeout) {\n        yield put(hideErrorAction());\n    }\n}\n\nexport function* workGetUser(){\n    try{\n        const current_user = yield call(fetchGetDataUser);\n        if(current_user && current_user.id !== undefined){\n            yield put(onCurrentUserAction(current_user))\n            yield put(push('/todo'));\n        }else{\n            localStorage.removeItem('token');\n            yield put(onLogoutAction());\n        }\n    } catch(error){\n        console.log('ERROR_SAGA ', error);\n    }\n}\n\nexport function* workerLoginUser(action) {\n    \n    const user : IUser = action.user;\n    console.log(user)\n    // try{\n    //     const data  = yield call(fetchLoginUser,user);\n    //     localStorage.setItem('token', data.token);\n        \n    //     const current_user = data.user;\n    //     yield put(onCurrentUserAction(current_user));\n    //     yield put(push('/todo'));\n\n    // }catch(error){\n    //     console.log('ERROR_SAGA: ', error);\n    //     const textError = 'Неверен логин или пароль';\n    //     yield call(show_error, { textError });\n    // }\n}\n\nexport function* workerCreateUser(action){\n    try{\n        const responseData = yield call(fetchCreateUser,action.user);\n        if (responseData.token){\n            yield put(push('/'));\n        }else{\n            let error;\n            if(responseData.username && responseData.password){\n                error = \"Такой пользователь существует. Пароль слишком легкий.\";\n            }else if (responseData.password){\n                error = \"Пароль слишком легкий.\";\n            }else if (responseData.username){\n                error = \"Такой пользователь существует.\";\n            }\n            if (error){\n                yield call(show_error, { error });\n            }\n        }\n    }catch(error){\n        console.log('ERROR_SAGA_SIGN_UP ', error );\n    }\n}\n\nexport function* workerResetPassword(action){\n    const password : string = action.password;\n    const token = action.token;\n    try {\n        const data = yield call(fetchResetPassword, password, token);\n        if(data){\n            yield call(show_error);\n        }else{\n            yield put(push('/'));\n        }\n    }catch(error){\n        console.log('ERROR_SAGA ', error );\n    }\n}\n\nexport function* workerSendEmail(action){\n    const email : string = action.email;\n    try {\n        yield call(fetchSendEmail, email);\n        yield put(push('/'));\n    }catch(error){\n        console.log('ERROR_SAGA ', error )\n    }\n    \n}"]},"metadata":{},"sourceType":"module"}